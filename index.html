<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Race Condition Running</title>
  <link rel='stylesheet' type='text/css' href='style.css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>

<div style='float: right;'>
  <img src='img/rcc-logo.png' width='150' alt='RCC Logo'>
</div>
<h1 style='padding-top: 20px;'>
  Race Condition Running
  <a target="_blank" href='https://www.facebook.com/groups/333912113433151/'>
    <img src='img/facebook-icon.png' height='20px'>
  </a>
</h1>
<div style='clear: both;'></div>

<h2>Schedule</h2>
<p>Meet at the run start point. Chit chat at conversation pace. Brunch nearby after.</p>
<div id='schedule'></div>

<h2>Routes</h2>

<div id='routes'></div>

<p style='padding-top: 20px;'>
  <img src='img/race-condition-running.jpg' width='600px'>
</p>

<script>
  var ROUTES;

  function fmtRoute(r) {
    var d = (Math.round(r.dist * 100) / 100).toFixed(2);
    return "<a name='" + r.uid + "'>"
         + "<a target='_blank' href='" + r.map + "'>"
         + "<span class='fll'>" + r.name + "</span>"
         + "<span class='flr'>" + d + "</span>"
         + "</a></a>";
  }

  $.getJSON("routedb.json", function(db) {
    ROUTES = db.routes;

    var rs = []
    $.each(db.routes, function(i, r) {
      rs.push( "<li id='" + r.uid + "'>"
             + fmtRoute(r) + "</li>");
    });

    $("<ul/>", {
      "id": "route-list",
      html: rs.join("")
    }).appendTo("#routes");
  });

  function lkup(uid) {
    for(var i = 0; i < ROUTES.length; i++) {
      var r = ROUTES[i];
      if(r.uid == uid) {
        return r;
      }
    }
    console.log("lkup: could not find " + uid);
  }

  var monthName =
    [ "Jan", "Feb", "Mar", "Apr", "May", "Jun"
    , "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
    ];

  /* bad use of globals :( */
  var today = new Date();
  var afterNext = false;

  function fmtRun(run) {
    var date = new Date(run.date);
    var plan = run.plan;

    var rows = "";
    for(var i = 0; i < plan.length; i++) {
      if(date < today) {
        rows += "<tr class='run past'>";
      } else {
        if(!afterNext) {
          rows += "<tr class='run next'>";
        } else {
          rows += "<tr class='run'>";
        }
      }

      rows += "<td class='date'>";
      if(i == 0) {
        var M = monthName[date.getMonth()];
        var D = date.getDate() + 1;
        rows += M + " " + D;
      }
      rows += "</td>";

      rows += "<td class='time'>";
      rows += plan[i].time;
      rows += "</td>";

      var route = lkup(plan[i].route);
      rows += "<td class='route'>";
      rows += "<a target='_blank' href='" + route.map + "'>" + route.name + "</a>";
      rows += "&nbsp; (" + route.dist + ")";
      rows += "</td>";

      rows += "</tr>";
    }

    if(date > today && !afterNext) {
      afterNext = true;
    }
    return rows;
  }

  function fmtRuns(runs) {
    var rows = "";
    for(var i = 0; i < runs.length; i++) {
      rows += fmtRun(runs[i]);
      rows += "<tr class='spacer'></tr>";
    }
    return rows;
  }

  $.getJSON("sched.json", function(data) {
    $("<table/>", {
      "id": "runs",
      html: fmtRuns(data.sched)
    }).appendTo("#schedule");
  });

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84537680-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
