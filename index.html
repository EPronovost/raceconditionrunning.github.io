<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Race Condition Running</title>
  <link rel='stylesheet' type='text/css' href='style.css'>
  <script src="jquery.min.js"></script>
</head>
<body>

<div style='float: right;'>
  <img src='img/rcc-logo.png' width='150' alt='RCC Logo'>
</div>
<h1 style='padding-top: 20px;'>
  Race Condition Running
  <a target="_blank" href='https://www.facebook.com/groups/333912113433151/'>
    <img src='img/facebook-icon.png' height='30px'>
  </a>
</h1>
<div style='clear: both;'></div>

<h2>
  Schedule
  <!-- add a query param on ics link to bypass cache for testing (e.g. ?foo) -->
  <a target="_blank"
     href="http://www.google.com/calendar/render?cid=http://raceconditionrunning.com/rcc.ics">
    <img src='img/cal-icon.png' height='25px'>
  </a>
</h2>

<h3>Weekend</h3>

<p>Meet at the run start point. Chit chat at conversation pace. Brunch nearby after.</p>
<div id='schedule'>
  <table id='runs'></table>
</div>

<h3>Wednesday</h3>

<p>Meet in CSE atrium at 5:30pm and do a few miles on the Burke.</p>


<h2>Routes</h2>

<div id='routes'>
  <ul id='route-list'></ul>
</div>

<p style='padding-top: 20px;'>
  <img src='img/race-condition-running.jpg' width='600px'>
</p>

<script>
$(function() {
  var ROUTES;
  var SCHED;

  function lkup(uid) {
    for(var i = 0; i < ROUTES.length; i++) {
      var r = ROUTES[i];
      if(r.uid == uid) {
        return r;
      }
    }
    console.log("lkup: could not find " + uid);
  }

  var monthName =
    [ "Jan", "Feb", "Mar", "Apr", "May", "Jun"
    , "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
    ];


  function main() {
    dispRoutes();
    dispSched();
  }

  function dispRoutes() {
    for(var i = 0; i < ROUTES.length; i++) {
      $("<li/>", {
        html: fmtRoute(ROUTES[i])
      }).appendTo("#route-list");
    }
  }

  function fmtRoute(r) {
    var d = (Math.round(r.dist * 100) / 100).toFixed(2);
    return "<a target='_blank' href='" + r.map + "'>"
         + "<span class='fll'>" + r.name + "</span>"
         + "<span class='flr'>" + d + "</span>"
         + "</a>";
  }

  function dispSched() {
    var today = new Date();
    var afterNext = false;

    var entries = [];
    for(var i = 0; i < SCHED.length; i++) {
      var run = SCHED[i];
      var date = new Date(run.date);

      // figure age with date after run
      var ndate = new Date(run.date);
      ndate.setDate(ndate.getDate() + 1);

      var age = "past";
      if(today < ndate) {
        if(!afterNext) {
          age = "next";
          afterNext = true;
        } else {
          age = "future";
        }
      }

      for(var j = 0; j < run.plan.length; j++) {
        var phase = run.plan[j];
        var route = lkup(phase.route);
        var entry = { date: ""
                    , time: phase.time
                    , name: route.name
                    , map:  route.map
                    , dist: route.dist
                    , age:  age
                    };
        if(j == 0) {
          var M = monthName[date.getMonth()];
          var D = date.getDate() + 1;
          entry.date = M + " " + D;
        }
        entries.push(entry);
      }
      entries.push(null);
    }

    for(var i = 0; i < entries.length; i++) {
      var e = entries[i];
      var row = "";
      if(e == null) {
        row = "<tr class='spacer'></tr>";
      } else {
        row = "<tr class='" + e.age + "'>"
            + "<td class='date'>" + e.date + "</td>"
            + "<td class='time'>" + e.time + "</td>"
            + "<td>"
            +    "<a target='_blank' href='" + e.map + "'>"
            +    e.name +  "</a>"
            +    "&nbsp; (" + e.dist + ")"
            + "</td>"
            + "</tr>";
      }
      $("#runs").append(row);
    }
  }

  $.getJSON("routedb.json", function(data) {
    ROUTES = data.routes;
    $.getJSON("sched.json", function(data) {
      SCHED = data.sched;
      main();
    })
  });
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84537680-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
