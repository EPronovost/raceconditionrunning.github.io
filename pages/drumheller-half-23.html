---
permalink: drumheller-half-23/
redirect_from:
- /dhm23/
---
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Drumheller Half Marathon 2023</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="13.1 miles around Drumheller Fountain, May 20th, 2023.">
    <meta property="og:image" content="{{ site.url }}/img/dhm23/dhm-23-og.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site.url }}/drumheller-half-23/">
    <meta property="og:title" content="Drumheller Half Marathon 2023">
    <meta property="og:description" content="Experience the fountain and the mountain. May 20th, 2023.">
    <link href="{{ site.baseurl }}/img/dhm23/dhm-favicon.png" rel="icon" type="image/png"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" integrity="sha512-b2QcS5SsA8tZodcDtGRELiGv5SaKSk1vDHDaQRda0htPYWZ6046lr3kJ5bAAQdpV2mmA/4v0wQF9MyU6/pDIAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Yrsa:ital,wght@0,300..700;1,300..700&family=Prompt:wght@700&display=swap"
          rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator-tables/6.1.0/css/tabulator.min.css" integrity="sha512-lYViaxM+7FHlHtQbmis/zPPWu+U+7AedEpiI1Jge4bhou50w1PxIokRz26zX4D3Jb9bEnaN9+mwDnjMKwFxqsg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator-tables/6.1.0/css/tabulator_bootstrap5.min.css" integrity="sha512-RQwKIKNxv0qAMe/KITeoOKX8bIR5Rl9rxZZyNrheBGQE1bSCjyGKVXAwHVMlDuu2eWSK+8+/pt2772A0TtD+Uw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js" integrity="sha512-X/YkDZyjTf4wyc2Vy16YGCPHwAY8rZJY+POgokZjQB2mhIRFJCckEGc6YyX9eNsPfn0PzThEuNs+uaomE5CO6A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe.min.css" integrity="sha512-LFWtdAXHQuwUGH9cImO9blA3a3GfQNkpF2uRlhaOpSbDevNyK1rmAjs13mtpjvWyi+flP7zYWboqY+8Mkd42xA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script type="importmap">
        {
          "imports": {
            "d3": "https://cdn.jsdelivr.net/npm/d3@7.9.0/+esm",
            "photoswipe": "https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe.esm.min.js",
            "photoswipe-lightbox": "https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.4.2/photoswipe-lightbox.esm.min.js",
            "tabulator-tables": "https://cdnjs.cloudflare.com/ajax/libs/tabulator-tables/6.1.0/js/tabulator_esm.min.js"
          }
        }
    </script>
</head>
<style>
    :root {
        font-size: 21px;
        line-height: 1.5;
    }

    body {
        margin: 0;
        --bs-body-bg: #010101;
        --bs-body-color: #eee;
        --bs-link-color-rgb: 220, 220, 220;
        --bs-link-hover-color-rgb: 200, 200, 200;
        --bs-body-font-family: 'Yrsa', serif;
        --sans-font-family: "Avenir Next", "Prompt", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
    }

    ::selection {
        background: #666;
    }

    hr {
        width: 6rem;
        margin: 4rem auto;
        display: block;
        border: 1px solid #DDD;
    }

    ul {
        /* Don't jam bullet at edge of screen on mobile */
        padding-left: 1rem
    }

    @media screen and (min-width: 700px) {
        ul {
            padding-left: 0;
        }
    }

    .imprint {
        text-align: center;
        margin-bottom: 1.5rem;
        font-weight: 300;
        text-shadow: 0 0 10px black;
    }

    .imprint a {
        text-decoration: none;
        color: #999;
        transition: .3s;
    }

    .imprint a:hover {
        color: #bbb;
    }

    .imprint img {
        width: 100px;
        opacity: .5;
        filter: invert();
        transition: .3s;
    }

    .imprint:hover img {
        opacity: .8;
    }

    .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 0 1rem
    }

    .call-wrapper {
        display: flex;
        justify-content: center;
    }

    .hero-button {
        --bs-btn-hover-bg: #eee;
        background-color: #ccc;
        --bs-btn-hover-color: black;
        --bs-btn-hover-border-color: transparent;
        color: black;
        text-decoration: none;
        opacity: 1;
    }

    .accordion-header button {
        font-family: var(--bs-body-font-family);
    }

    .accordion-button::after {
        filter: saturate(0%);
    }

    .accordion {
        --bs-accordion-btn-focus-border-color: #bbb;
        --bs-accordion-btn-focus-box-shadow: 0 0 0 0.25rem #bbb;
        --bs-accordion-border-radius: .75rem;
        --bs-accordion-inner-border-radius: .75rem;
        --bs-accordion-bg: #111;
        --bs-accordion-color: var(--bs-body-color);
        --bs-accordion-active-color: var(--bs-emphasis-color);
        --bs-accordion-active-bg: #333;
        --bs-accordion-border-color: transparent;
    }

    .accordion-item {
        border-bottom: 1px solid #666;
    }
    .accordion-item:last-of-type {
        border-bottom: none;
    }

    header {
        margin-bottom: 2rem;
    }

    header h1 {
        margin: 0;
        overflow: hidden;
    }

    #hero {
        padding: 2rem 0 calc(min(2rem + 20vw, 8rem)) 0;
        margin-bottom: 0;
        position: relative;
        overflow-x: clip;
    }

    #hero img {
        display: block;
        margin: 0 auto;
    }

    #hero .date {
        font-weight: 100;
        text-align: center;
        font-size: 24px;
    }

    #hero .imprint, #hero .date {
        opacity: 0;
        animation: fade-in 1s ease forwards;
        animation-delay: 3s;
    }

    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    #logo {
        position: relative;
        max-width: 100%;
        pointer-events: none;
        user-select: none;
    }

    #underlay-cw, #underlay-ccw {
        position: absolute;
        width: 180%;
        left: -40%;
        top: -35%;
        filter: blur(.5px); /* Lessen moire, aliasing */
        z-index: -1;

    }

    @keyframes rotating {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(-360deg);
        }
    }

    .rotating {
        animation: fade-in 10s ease, rotating 600s linear infinite;

    }

    .rotating.ccw {
        animation: fade-in 10s ease, rotating 600s reverse linear infinite;
    }

    @media (prefers-reduced-motion) {
        /* styles to apply if a user's device settings are set to reduced motion */
        .rotating,.rotating.ccw, #hero .imprint, #hero .date {
            animation: none;
        }
    }

    section {
        margin-bottom: 4rem;
    }

    h1, h2, h3, .hero-button {
        font-family: var(--sans-font-family);
        font-weight: 700;
        font-size: 1.2rem;
    }

    h3 {
        font-weight: 500;
    }

    .anchor-link {
        padding: 0 .175rem;
        font-weight: 400;
        color: rgba(255,255,255,0.5);
        text-decoration: none;
        opacity: 0;
        transition: color 0.15s ease-in-out,opacity 0.15s ease-in-out;
    }

    .anchor-link::after {
        content: "#";
    }

    .anchor-link:focus, .anchor-link:hover, :hover > .anchor-link, :target .anchor-link {
        text-decoration: none;
        opacity: 1;
    }

    .hero-button {
        font-weight: 600;
        font-size: 1rem;
    }

    #overview {
        max-width: 500px;
        margin: 0 auto;
        text-align: center;
        margin-bottom: 4rem;
    }

    #course-map {
        border-radius: 1rem;
        margin-bottom: 1rem;
    }

    #history, #overview {
        font-weight: 100;
    }

    .blockquote {
        font-style: italic;
        font-size: 1rem;
    }

    .blockquote-footer {
        color: #888;
    }

    footer {
        margin: 6rem 0 6rem 0;
    }

    #epilogue {
        margin-top: 4rem;
        padding-top: 4rem;
    }

    #epilogue .container {
        margin-bottom: 2rem;
    }

    #epilogue h1 {
        margin-bottom: 2rem;
    }

    figure {
        max-width: 1200px;
        margin: 0 auto 2rem auto;
    }

    figure img {
        width: 100%;
    }

    .full-width {
        width: 100vw;
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
    }

    .cert-wrapper {
        display: flex;
        justify-content: center;
    }

    .usatf-certificate {
        font-size: .75rem;
        font-family: var(--sans-font-family);
        border: 2px solid #aaa;
        border-radius: .75rem;
        display: inline-flex;
        gap: .75rem;
        flex-direction: row;
        justify-content: center;
        margin-bottom: 0;
        padding: .75rem .75rem;
        text-decoration: none;
        color: #ddd;
        transition: .3s;
    }

    .usatf-certificate:hover {
        color: white;
        border: 2px solid #ccc;
    }

    .usatf-certificate:hover img {
        opacity: 1;
    }

    .usatf-certificate img {
        height: 4rem;
        opacity: .8;
        transition: .3s;
    }

    .usatf-certificate .details {
        align-self: center;
    }

    .usatf-certificate,
    .usatf-certificate h2,
    .usatf-certificate p {
        font-size: .75rem;
        margin-bottom: 0;
    }

    .table {
        background: transparent;
        width: auto;
        min-width: 200px;
        line-height: 36px;
        --bs-table-bg: var(--bs-dark-bg-subtle);
    }

    .table th {

    }

    .table tr td {
        border-bottom-width: 0;
    }

    .table thead {
        border-bottom-width: 1px;
    }

    .result-detail {
        padding: 1rem;
    }

    .laps-graph {
        width: 100%
    }

    .laps-graph rect {
        transition: .15s;
    }

    .laps-graph .tick line {
        color: white;
        opacity: .5;
    }

    .laps-graph .minor {
        opacity: .4;
        color: white
    }

    .laps-graph .horizontal-grid {
        color: white;
        opacity: .5;
    }

    .laps-graph .data-bar {
        fill: #777;
        opacity: .9;
        stroke: #aaa;
        stroke-width: .5px;
    }

    .laps-graph .data-bar.extra {
        fill: #555
    }

    .laps-graph .data-bar.highlighted {
        fill: #999;
    }

    .laps-graph #flaglines line {
        stroke: #ccc;
        stroke-width: 1px
    }

    .laps-graph .finish-flag[data-lap-target='110'] line {
        stroke: rgb(0,177,220);
    }

    .laps-graph .finish-flag[data-lap-target='110'] polygon {
        fill: rgb(0,177,220);
    }

    .laps-graph .finish-flag[data-lap-target='84'] line {
        stroke: #65b900;
    }

    .laps-graph .finish-flag[data-lap-target='84'] polygon {
        fill: #65b900;
    }

    .laps-graph .finish-flag[data-lap-target='52'] line {
        stroke: #DC00D1;
    }

    .laps-graph .finish-flag[data-lap-target='52'] polygon {
        fill: #DC00D1;
    }

    .laps-graph .finish-flag[data-lap-target='26'] line {
        stroke: #dc8400;
    }

    .laps-graph .finish-flag[data-lap-target='26'] polygon {
        fill: #dc8400;
    }

    .laps-graph .finish-flag text {
        font-family: var(--sans-font-family);
        font-weight: bold;
        font-size: 16px;
    }

    .tabulator {
        font-size: 1rem;
    }

    .tabulator,
    .tabulator .tabulator-header .tabulator-col,
    .tabulator .tabulator-header,
    .tabulator .tabulator-tableholder .tabulator-table,
    .tabulator .tabulator-footer {
        background-color: transparent;
    }

    .tabulator-row.tabulator-group {
        background-color: rgba(255, 255, 255, 0.075) !important;
    }

    .tabulator .tabulator-tableholder .tabulator-table .tabulator-row.tabulator-calcs {
        background-color: transparent !important;
    }

    .tabulator-row, .tabulator-row.tabulator-row-even {
        background-color: transparent;
    }

    .tabulator-row.details-opened.tabulator-selectable,
    .tabulator .tabulator-header .tabulator-col.tabulator-sortable.tabulator-col-sorter-element {
        transition: .2s;
    }

    .tabulator .tabulator-header .tabulator-col.tabulator-sortable.tabulator-col-sorter-element:hover {
        background-color: rgba(255, 255, 255, .3);
    }

    .tabulator-row.tabulator-selectable:hover {
        background-color: rgba(255, 255, 255, .3);
    }

    .tabulator-row.details-opened.tabulator-selectable,
    .tabulator-row.details-opened.tabulator-selectable:hover {
        background-color: #111;
    }

    .tabulator .tabulator-header {
        border-top: none;
    }

    .laps-table {
        padding: 1rem;
    }

    .tabulator .tabulator-tableholder .tabulator-table .tabulator-row.tabulator-calcs.tabulator-calcs-bottom {
        border-top: 2px solid #999;
    }

    .laps-table.tabulator .tabulator-header {
        border-bottom: 1px dashed #999;
    }

    .laps-table .tabulator-row {
        border-bottom: 1px dashed #999;
    }

    .laps-table .tabulator-row .tabulator-cell {
        padding: 4px;
    }
    .laps-table.tabulator .tabulator-tableholder .tabulator-table .tabulator-row.tabulator-calcs.tabulator-calcs-bottom {
        border-top: 1px dashed #999;
        border-bottom: none;
    }

    .tabulator-row.tabulator-group {
        border-top: 1px dashed #999;
        border-right: none;
    }

    .tabulator-row.tabulator-group:first-of-type {
        /* Hide the "official laps" header */
        display: none;
    }

    .laps-table .tabulator-footer {
        border-top: 1px dashed #999;
        border-bottom: none;
    }

    .tabulator-tableholder, .tabulator-table {
        max-width: 100%;
    }

</style>
<body>

<section id="hero">
    <div class="container d-flex flex-column gap-3">
        <p class="imprint"><a href="{{ site.baseurl }}/">Race Condition Running</a></p>
        <header>

            <div id="logo">
                <img id="overlay" src="{{ site.baseurl }}/img/dhm23/dhm23.svg"
                     alt="Line art of a fountain surrounded by text Drumheller Half Marathon 2023"/>
                <img id="underlay-cw" class="rotating" src="{{ site.baseurl }}/img/dhm23/rose.webp" alt=""/>
                <img id="underlay-ccw" class="rotating ccw" src="{{ site.baseurl }}/img/dhm23/rose.webp" alt=""/>
            </div>


        </header>
        <p class="date">7:50AM Saturday, May 20th, 2023</p>

    </div>

</section>

<section id="overview">
    <div class="container">
        <p>Join us for 110 laps around Drumheller Fountain. Stick around after for food and music at the
            <a href="https://udistrictstreetfair.org" class="d-inline-block">U-District Street Fair</a>.
        </p>
        <div class="call-wrapper gap-2">
            <!--a class="btn hero-button " href="https://forms.gle/tk9xDDHgaXMzLMDC8">Sign Up</a-->
            <a class="btn hero-button" href="#results">Results</a>
            <!--a class="btn hero-button" href="https://forms.gle/qDgVHA3Kw1HVFDrN8">Order Shirt</a-->
            <!--a class="btn hero-button" href="#epilogue">Read Epilogue</a-->
        </div>
        <div class="alert alert-dark mt-3" role="alert" style="">
            This event took place in 2023. Looking for <a href="{{ site.baseurl }}/dhm">a more recent Drumheller Half</a>?
        </div>
    </div>

</section>

<section>
    <div class="container">
        <h2 id="course">Course <a href="#course" class="anchor-link" aria-label="Link to this section. Course"></a></h2>
        <p>The course begins with a short segment down the upper vista, followed by 110 laps around Drumheller Fountain.
            Runners will enter first loop from the east of the finish line and begin by running counterclockwise. The
            direction will flip every 20 minutes, and runners must change directions only by rounding the marker placed
            at the north end of the finish line. Failure to follow these instructions will prevent us from giving you an
            official finish time.</p>
        <p>While campus foot traffic is reduced on weekends, expect to navigate around fountain-admirers, passers-by and
            cyclists. The fountain—and the race—will start at 8:00.</p>
        <img id="course-map" src="{{ site.baseurl }}/img/dhm23/dhm-course-map.svg"
             alt="A map of the course showing the start line 120.50m north of the fountain, followed by 110 laps of the 190.70m fountain loop.">
        <div class="cert-wrapper">
            <a class="usatf-certificate" href="https://certifiedroadraces.com/certificate/?type=m&id=2487">
                <img src="{{ site.baseurl }}/img/dhm23/usatf-certified-course-white.svg" alt=""/>
                <div class="details">
                    <h2>USATF Certificate</h2>
                    <span>WA23019RMB</span>
                    <p><b>Effective</b>: 4/15/23<br/>
                    <b>Through</b>: 12/31/33</p>
                </div>
            </a>
        </div>
    </div>
</section>

<section>
    <div class="container">
        <h2 id="race-day">Race Day <a href="#race-day" class="anchor-link" aria-label="Link to this section. Race Day"></a></h2>
        <ul>
            <li>Bring a water bottle</li>
            <li>Dress for sun and heat</li>
            <li>Be at the start line at 7:50AM for brief course instructions and the start photo</li>
        </ul>
    </div>
</section>

<section>
    <div class="container">
        <h2 class="mb-4" id="faq">FAQ <a href="#faq" class="anchor-link" aria-label="Link to this section. FAQ"></a></h2>
        <accordion-group id="faq-items">
            <accordion-item>
                <accordion-header>Who can participate?</accordion-header>
                <accordion-body>Anyone in the CSE community.</accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>Do I need to bring anything?</accordion-header>
                <accordion-body>Bring a water bottle. As of 10:00PM on 5/18 the forecast calls for
                        partly
                        cloudy skies and temperatures approaching 65°F by the end of the run. Please prepare
                        appropriately
                        as the course is <a
                                href="https://shademap.app/@47.65378,-122.3075,17.185z,1684335621728t,0b,0p,0m">essentially
                            without shade</a>.
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>How do we keep track of distance?</accordion-header>
                <accordion-body>Count your laps. Use a running watch, if you're wearing one. Or
                        we'll have a
                        couple <a href="https://en.wikipedia.org/wiki/Tally_counter">tally counters</a> available if
                        you
                        want mechanical assistance. <a href="{{ site.baseurl }}/dhm22">Last year</a> we ran as a
                        group and
                        counted laps out loud. GPS will clip the curve, so don't rely on it for more than a couple
                        laps at a
                        time.
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>Will the course be crowded?</accordion-header>
                <accordion-body>There is plenty of space. We are expecting around 20
                        participants, and only
                        half plan to complete 13.1 miles. That being said, here is the course etiquette:
                        <ul>
                            <li>Step to the outside of the course before stopping</li>
                            <li>Groups: Do not run more than 3 abreast and yield the innermost lane around the
                                fountain to
                                faster runners
                            </li>
                            <li>Faster runners: Pass on the outside if you need to</li>
                        </ul>
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>Which direction do we run?</accordion-header>
                <accordion-body>The race will begin counterclockwise and alternate directions
                        every 20
                        minutes to help balance the strain across your legs. Having the field run a single
                        direction at a
                        time will help us manage course congestion. Change directions only at the end of a lap
                        and only by
                        rounding the finish line marker.
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>Do I have to run the whole thing?</accordion-header>
                <accordion-body>No. You're welcome to come join for any number of laps. They
                        don't have to
                        be consecutive either! Here are some unofficial lap counts for common distances. Add a
                        lap if not
                        starting at the official start line.
                        <table class="table table-sm ms-2 mt-2 mb-4">
                            <thead>
                            <tr>
                                <th scope="col">Distance</th>
                                <th scope="col">Laps</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>5k</td>
                                <td>26</td>
                            </tr>
                            <tr>
                                <td>10k</td>
                                <td>52</td>
                            </tr>
                            <tr>
                                <td>10mi</td>
                                <td>84</td>
                            </tr>
                            </tbody>
                        </table>
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>Can I take breaks?</accordion-header>
                <accordion-body>Yes. You can hang out at the aid station or any of the benches
                        surrounding
                        the course. You must continue running the lap in the same direction as when you stopped
                        or the lap
                        will not count. We recommend you start and stop only at the finish line so you can begin
                        the next
                        lap without this risk.
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>How fast do I need to run?</accordion-header>
                <accordion-body>You should be able to complete your chosen distance in under 2.5
                        hours.
                </accordion-body>
            </accordion-item>
            <accordion-item>
                <accordion-header>What if I'm late?</accordion-header>
                <accordion-body>Run from the start line and join us! You must enter the course
                        from "behind"
                        the finish line in the direction that the field is running at the time you join. So, if
                        we're
                        running counterclockwise, start your first loop by crossing over the finish line from
                        the east, and
                        otherwise from the west. Note that this event is <a
                                href="https://www.runnersworld.com/training/a20793329/chip-time-vs-gun-time/">gun
                            time</a>
                        only.
                </accordion-body>
            </accordion-item>
        </accordion-group>
    </div>
</section>

<section>
    <div class="container-xxl">
        <h2 class="mb-4" id="results">Results <a href="#results" class="anchor-link" aria-label="Link to this section. Results"></a></h2>
        <h3>Official</h3>
        <div id="results-table-official" class="mb-5"></div>
        <hr/>
        <h3>Unofficial</h3>
        <div id="results-table-unofficial" class="mb-5"></div>
    </div>

</section>

<section id="epilogue">

    <figure>
        <img src="{{ site.baseurl }}/img/dhm23/fountain.avif" class="w-100 rounded mb-4" />

    </figure>
    <div class="container">
        <h2 class="mb-4">Epilogue <a href="#epilogue" class="anchor-link" aria-label="Link to this section. Epilogue"></a></h2>

        <p>The campus was already glowing as we gathered at the start line. None of the weekday thrum, and&mdash;with cherry blossoms long gone&mdash;nary a tourist. Just the sun bearing down, and 32 runners ready to round the fountain.</p>

        <p>11 would go on to complete the half marathon. Congratulations to Ellis (1:45:58) and Margaret (2:03:06) for setting new course records, and to Mitch who set a new lap record of 26.00s. This was the first year we provisioned for an official course and timing, so you can take those times to the bank. Many elected to run shorter distances (some unintentionally), so together we completed 2263 laps around Drumheller Fountain. Thank you to everyone who ran and stocked the aid station, and special thanks to Aishwarya for taking photos.</p>

        <p>We've continued to iron out some of the difficulties of the format. The increased field size required us to run in a single direction at a time, an improvement in every regard except that it made it easier for groups to run four abreast and block the path. Zach equipped us with tally counters this year, but counting laps still proved difficult in practice. So, challenges remain.</p>

        <p>Drumheller is a singular race. It's an indoor track half marathon, held outside at our doorstep, with Mount Rainier and the University of Washington's historic Rainier Vista as its backdrop. Few halves even run in Seattle proper these days, but no event in the world completes the distance on a shorter loop. It's a captivating idea that will only become stronger with each running.</p>

        <p><i>Nick Walker</i></p>
    </div>
    <figure id="gallery" class="d-flex flex-column gap-4 auto-lightbox">
        <a href="{{ site.baseurl }}/img/dhm23/3.avif">
            <img loading="lazy" src="{{ site.baseurl }}/img/dhm23/3.avif"
                 class="w-100 shadow-1-strong rounded"/>
        </a>

        <div class="d-flex flex-column flex-sm-row gap-4">
            <div class="col d-flex flex-column gap-4">
                <a href="{{ site.baseurl }}/img/dhm23/4.webp">
                    <img loading="lazy" src="{{ site.baseurl }}/img/dhm23/4.webp"
                         class="w-100 shadow-1-strong rounded"/>
                </a>
                <a href="{{ site.baseurl }}/img/dhm23/2.avif">
                    <img loading="lazy" src="{{ site.baseurl }}/img/dhm23/2.avif"
                        class="w-100 shadow-1-strong rounded"/>
                </a>
            </div>

            <div class="col d-flex flex-column gap-4">
                <a href="{{ site.baseurl }}/img/dhm23/1.avif">
                    <img loading="lazy" src="{{ site.baseurl }}/img/dhm23/1.avif"
                         class="w-100 shadow-1-strong rounded">
                </a>

                <a href="{{ site.baseurl }}/img/dhm23/5.webp">
                    <img loading="lazy" src="{{ site.baseurl }}/img/dhm23/5.webp"
                     class="w-100 shadow-1-strong rounded"/>
                </a>
            </div>

        </div>
    </figure>

</section>

<hr/>

<section id="history">
    <div class="container">
        <figure>
        <blockquote class="blockquote">Rainier Vista, partly framed by Johnson and Mary Gates halls, is the most sacred space on campus.
            The vista was first conceived as a centerpiece of the campus plan by the Olmsted Brothers in 1906, when the
            elusive mountain revealed itself during the firm's visit to Seattle to develop a plan for the Alaska Yukon
            Pacific Exposition. Rainier Vista is the most dramatic borrowing from nature on any campus in the United
            States, with Mount Rainier as its climax, and with both architecture and landscape reinforcing its thrust
            past a minor view of the city toward the mountain beyond. As Edmond Meany put it, &#8220;No campus in all the
            world can equal Rainier Vista. In those rare moments when Mother Nature in kindly mood pulls aside the
            vaporous curtains we may gaze upon Mt. Rainier, a three-mile…flow…of rock and ice. A spectacle of unending
            fascination!&#8221;
        </blockquote>
        <figcaption class="blockquote-footer">Norman J. Johnston, <cite title="The Fountain and the Mountain">The Fountain and the Mountain</cite>
        </figcaption>
        </figure>

    </div>
</section>


<footer>
    <p class="imprint"><a href="{{ site.baseurl }}/"><img src="{{ site.baseurl }}/img/happy-toast.svg"
                                                          alt="A happy piece of toast who is running"/></a></p>
</footer>

<template id="result-detail-template">
    <div class="result-detail-holder">
        <div class="result-detail">
            <p>
                <span class="total-laps"></span>
                <span class="average-pace"></span>
            </p>
            <div class="laps-graph d-block"></div>
            <div class="pace-graph d-block"></div>
            <div class="laps-table d-block"></div>
        </div>
    </div>
</template>

<script type="module" >
    import {Tabulator, ColumnCalcsModule, GroupRowsModule, FormatModule, InteractionModule, ResizeColumnsModule, ResizeTableModule, ResponsiveLayoutModule, SortModule, SelectRowModule} from 'tabulator-tables';
    Tabulator.registerModule([ColumnCalcsModule, FormatModule, GroupRowsModule, InteractionModule, ResizeColumnsModule, ResizeTableModule, ResponsiveLayoutModule, SortModule, SelectRowModule]);
    import {formatDuration, formatPace, prepareImagesForPhotoswipe} from "{{ site.baseurl }}/js/common.js";
    import {AccordionGroup, AccordionItem, AccordionHeader, AccordionBody} from '{{ site.baseurl }}/js/accordion.js';
    import {LapPaceChart} from "{{ site.baseurl }}/js/LapPaceChart.js";
    import PhotoSwipeLightbox from 'photoswipe-lightbox';
    import * as d3 from 'd3';


    function addResultsDetails(data, paceGraphContainer, lapsGraphContainer, tableContainer) {
        let lapObjects = []
        let timeElapsed = 0
        let distanceElapsed = 0
        let directionIndex = 0
        let lapsRun = data.lapTimes.length - 1
        let goals = [26, 52, 84, 110]
        let lapTarget = goals[Math.max(d3.bisectRight(goals, lapsRun) - 1, 0)]
        for (let i = 0; i < data.lapTimes.length; i++) {
            const lapDistance = i > 0 ? 190.70 : 120.50
            let pace = lapDistance / data.lapTimes[i]
            let lapStartTime = timeElapsed
            timeElapsed += data.lapTimes[i]
            distanceElapsed += lapDistance
            if (lapStartTime > directionChanges[directionIndex]) {
                directionIndex += 1
            }
            let direction = directionIndex % 2 === 0 ? "CCW" : "CW"
            if (i === 0) {
                // 0th lap is entrance from upper vista
                direction = null
            }
            lapObjects.push({
                "n": i,
                "time": data.lapTimes[i],
                "distance": lapDistance,
                "distanceElapsed": distanceElapsed,
                "timeElapsed": timeElapsed,
                "pace": pace,
                "paceMi": 1609.34 / pace,
                "paceKm": 1000 / pace,
                "extra": i > lapTarget,
                "direction": direction
            })
        }

        lapsGraphContainer.appendChild(new LapPaceChart().draw(lapObjects, lapTarget, (barNumber)=> {
            view.scrollToRow(barNumber)
        }))

        let view
        let lapsTable = new Promise((resolve, reject) => {
            view = new Tabulator(tableContainer, {
                data: lapObjects,
                selectable: false,
                index: "n",
                groupBy: "extra",
                height: 300,
                responsiveLayout: "collapse",
                initialSort: [{column: "n", dir: "asc"}],
                columns: [
                    {title: "N", field: "n", sorter: "number", responsive: 0},
                    {
                        title: "Time",
                        field: "time",
                        formatter: cell => formatDuration(cell.getValue(), false, true),
                        bottomCalc: (values, data, calcParams) => {
                            if (values.length === 0) {
                                return ""
                            }
                            let averagePace = values.reduce((a, b) => a + b, 0) / values.length
                            return formatDuration(averagePace, false, true)
                        }
                    },
                    {
                        title: "Pace /mi",
                        field: "paceMi",
                        formatter: (cell) => formatDuration(cell.getValue(), false, false, true),
                        bottomCalc: (values, data, calcParams) => {
                            if (values.length === 0) {
                                return ""
                            }
                            let averagePace = values.reduce((a, b) => a + b, 0) / values.length
                            return formatPace(averagePace, "")
                        }
                    },
                    {
                        title: "Elapsed", field: "timeElapsed", formatter: (cell) =>
                            `<a href='https://youtu.be/lmwxMUa7bvI?t=${Math.floor(cell.getValue())}'>${formatDuration(cell.getValue(), true, false)}</a>`

                        , headerSort: false
                    },
                    {title: "Meters", field: "distanceElapsed", responsive: 4, width: 200, headerSort: false, formatter: cell => cell.getValue().toFixed(1)},
                    {
                        title: "Direction",
                        field: "direction",
                        responsive: 5,
                        width: 200,
                        headerSort: false,
                        bottomCalc: (values, data, calcParams) => {
                            if (values.length === 0) {
                                return []
                            }
                            let counts = values.filter(a => a).reduce((a, b) => b === "CCW" ? [a[0] + 1, a[1]] : [a[0], a[1] + 1], [0, 0])
                            return counts
                        },
                        bottomCalcFormatter: (cell, data, params) => {
                            let counts = cell.getValue()
                            return `${counts[0]}<span class='direction-symbol mx-1'>↺</span> ${counts[1]}<span class='direction-symbol mx-1'>↻</span>`
                        }
                    }
                ]
            })
            view.on("tableBuilt", () => view.setGroupHeader(function (value, count, data, group) {
                if (value) {
                    return "Extra Laps (" + count + ")";
                } else {
                    return ""
                }

            }));
            view.on("renderComplete", resolve)

        })
        return Promise.all([lapsTable])
    }

    let rowFormatter = function (row, e) {
        let rowElement = row.getElement()
        rowElement.id = `#result-${row.getData().id}`
        let detailFragment = detailTemplate.cloneNode(true)
        //create and style holder elements
        const id = row.getData().id
        let containerElement = detailFragment.querySelector(".result-detail-holder")
        containerElement.setAttribute('id', "result-detail-" + id + "");
        containerElement.setAttribute("hidden", "hidden")
        rowElement.appendChild(detailFragment);
    }

    let expandRow = function (row) {
        row.getElement().classList.toggle("details-opened")
        let detailsContainer = row.getElement()?.querySelector(".result-detail-holder")
        if (!detailsContainer.classList.contains("initialized")) {
            // Tabulator and Vega won't render correctly unless the parent element is visible
            detailsContainer.toggleAttribute("hidden")
            addResultsDetails(row.getData(), detailsContainer.querySelector(".pace-graph"), detailsContainer.querySelector(".laps-graph"), detailsContainer.querySelector(".laps-table")).then(() => {
                row.getTable().redraw()
            })
            detailsContainer.classList.add("initialized")
        } else {
            detailsContainer.toggleAttribute("hidden")
            row.getTable().redraw()
        }
    }

    function scrollToResult(table) {
        let hash = window.location.hash
        if (hash) {
            let id = parseInt(hash.match(/\d+(?=\D*$)/)[0])
            let row = table.getRow(id); //return row component with index of 1

            if (row) {
                // Need to have table in view for it to fully load
                table.element.scrollIntoView({
                    behavior: 'smooth'
                });
                // HACK: wait a bit so scroll ends
                setTimeout(() => table.scrollToRow(id, "center", false).then(() => expandRow(row)), 750)

            }
        }
    }

    function rowClicked(e, row) {
        if (!(e.target.classList.contains("tabulator-row") || e.target.classList.contains("tabulator-cell"))) {
            return
        }
        expandRow(row)
        let currentHash = window.location.hash
        let newHash = `#result-${row.getData().id}`
        if (!row.getElement().querySelector(".result-detail-holder").attributes["hidden"]) {
            history.replaceState(undefined, undefined, newHash)
        } else if (currentHash === newHash) {
            history.replaceState(undefined, undefined, " ")
        }
    }

    let detailTemplate = document.getElementById("result-detail-template").content
    let directionChanges = [60 * 20 + 26, 60 * 40 + 14, 59 * 60 + 48, 80 * 60, 100 * 60 + 12, 120 * 60 + 20, 140 * 60]
    fetch('{{ site.baseurl }}/results/dhm23.json')
        .then(res => res.json())
        .then(dhm23Results => {

            let officialResults = []
            let unofficialResults = []
            for (let i = 0; i < dhm23Results.length; i++) {
                let entry = dhm23Results[i]
                let countedLaps = Math.min(entry.lapTimes.length, 111)
                entry["finishTime"] = entry.lapTimes.slice(0, countedLaps).reduce((a, b) => a + b, 0)
                entry["5kTime"] = countedLaps > 26 ? entry.lapTimes.slice(0, 27).reduce((a, b) => a + b, 0) : Infinity
                entry["10kTime"] = countedLaps > 52 ? entry.lapTimes.slice(0, 53).reduce((a, b) => a + b, 0) : Infinity
                entry["10miTime"] = countedLaps > 84 ? entry.lapTimes.slice(0, 85).reduce((a, b) => a + b, 0) : Infinity
                entry["nLaps"] = entry.lapTimes.length
                if (entry.lapTimes.length < 111) {
                    unofficialResults.push(entry)
                } else {
                    officialResults.push(entry)
                }
            }

            let officialTable = new Tabulator("#results-table-official", {
                data: officialResults,
                layout: "fitDataFill",
                nestedData: true,
                responsiveLayout: true,
                initialSort: [{column: "finishTime", dir: "asc"}],
                columns: [
                    {title: "Name", field: "name", resizable: false},
                    {
                        title: "Finish Time", field: "finishTime", sorter: "number", formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    },
                    {
                        title: "5k Time", field: "5kTime", sorter: "number", responsive: 3, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    },
                    {
                        title: "10k Time", field: "10kTime", sorter: "number", responsive: 2, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    },
                    {
                        title: "10mi Time", field: "10miTime", sorter: "number", responsive: 1, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    }
                ],
                rowFormatter: rowFormatter
            })


            let unofficialTable = new Tabulator("#results-table-unofficial", {
                data: unofficialResults,
                layout: "fitDataFill",
                nestedData: true,
                responsiveLayout: true,
                initialSort: [{column: "nLaps", dir: "desc"}],
                columns: [
                    {title: "Name", field: "name", resizable: false},
                    {
                        title: "Laps", field: "nLaps", sorter: "number", formatter: (cell) => {
                            return cell.getData().nLaps - 1
                        }, resizable: false
                    },
                    {
                        title: "5k Time", field: "5kTime", sorter: "number", responsive: 3, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    },
                    {
                        title: "10k Time", field: "10kTime", sorter: "number", responsive: 2, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    },
                    {
                        title: "10mi Time", field: "10miTime", sorter: "number", responsive: 1, formatter: cell => formatDuration(cell.getValue(), true), resizable: false
                    }
                ],
                rowFormatter: rowFormatter
            })

            officialTable.on("tableBuilt", () => scrollToResult(officialTable))
            unofficialTable.on("tableBuilt", () => scrollToResult(unofficialTable))

            officialTable.on("rowClick", rowClicked)
            unofficialTable.on("rowClick", rowClicked)
        })

    document.addEventListener('DOMContentLoaded', e => {
        prepareImagesForPhotoswipe(document.querySelectorAll(".auto-lightbox a")).then(() => {
            const lightbox = new PhotoSwipeLightbox({
                gallery: '#gallery',
                children: 'a',
                showHideAnimationType: 'zoom',
                showAnimationDuration: 200,
                hideAnimationDuration: 200,
                pswpModule: () =>  import("photoswipe")

            });
            lightbox.init();
        });
    })


</script>

</body>
</html>
